import {ChangeNotifier} from "../../providerJS/provider.js";

import {deleteUser, getProfile, getStageRank, getStages, getUserRank, logout} from "./api.js";

export class MainViewModel extends ChangeNotifier {
    nickname
    username
    stages = []
    ranks = []

    stageRank = []
    stageStar1 = 20;
    stageStar2 = 16;
    stageStar3 = 12;
    pointStage = 1;
    stageName=""

    hide = true;

    async open(stageId) {
        this.pointStage = stageId;
        this.stageRank = await getStageRank(stageId);
        let stageJson = this.stages[stageId - 1];
        this.stageName = stageJson.stage.name;
        this.stageStar1 = stageJson.stage.star1;
        this.stageStar2 = stageJson.stage.star2;
        this.stageStar3 = stageJson.stage.star3;

        console.log( this.stageRank);

        this.hide = false;
        this.notifyListeners();
    }

    close() {
        this.hide = true;
        this.notifyListeners();
    }

    complete = false;


    constructor() {
        super();
        this.init();
    }

    async init() {
        this.stages = await getStages();
        this.ranks = await getUserRank();
        let js = getProfile();

        this.complete = true;
        this.notifyListeners();
    }

    profile() {
        let js = getProfile();
        console.log(js)
    }

    logout() {
        logout();
    }

    deleteUser() {
        deleteUser();
    }


    stagesDummy = [
        {
            "stage": {
                "id": 1,
                "star1": 20,
                "star2": 15,
                "star3": 10,
                "name": "tutorial",
                "map": "[[1,2,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,0,0,0,0],[0,1,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0]]"
            },
            "clear": true,
            "unlock": true,
            "move": 6,
            "star": 3
        },
        {
            "stage": {
                "id": 2,
                "star1": 15,
                "star2": 12,
                "star3": 8,
                "name": "grace",
                "map": "[[1,1,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,1,0,0,0,0,0,3,0,2,0,0],[0,1,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0]]"
            },
            "clear": true,
            "unlock": true,
            "move": 14,
            "star": 1
        },
        {
            "stage": {
                "id": 3,
                "star1": 21,
                "star2": 16,
                "star3": 13,
                "name": "maze",
                "map": "[[1,1,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],[0,0,0,0,1,0,0,0,0,0,3,0,2,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,1,0,1,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0]]"
            },
            "clear": false,
            "unlock": true,
            "move": 0,
            "star": 0
        },
        {
            "stage": {
                "id": 4,
                "star1": 15,
                "star2": 12,
                "star3": 8,
                "name": "stone",
                "map": "[[1,1,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,1,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,0,0,0,0,0,0,0,1,0,0,1,0,0,0],[0,0,0,0,1,0,0,0,0,0,3,0,2,0,0],[0,1,0,0,0,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,1,0]]"
            },
            "clear": false,
            "unlock": false,
            "move": 0,
            "star": 0
        },
        {
            "stage": {
                "id": 5,
                "star1": 15,
                "star2": 12,
                "star3": 8,
                "name": "wall",
                "map": "[[1,1,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,0,0,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,1,0,1,0,0,0,0,0,1,0,0],[0,1,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,2,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0]]"
            },
            "clear": false,
            "unlock": false,
            "move": 0,
            "star": 0
        }
    ];
}




